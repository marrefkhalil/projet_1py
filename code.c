#include<stdlib.h>
#include<stdio.h>
#include <stdint.h>
uint32_t ror(uint32_t x, int n);

uint32_t rol(uint32_t x, int n);

int main(int argc, char** arv)
{
    unsigned char programme[] = "\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\xa1\x91\x04\x08\xba\x26\x00\x00\x00\xcd\x80\xb8\x03\x00\x00\x00\x31\xdb\xb9\x88\x91\x04\x08\xba\x33\x00\x00\x00\xcd\x80\x31\xc9\xb8\x80\x80\x04\x08\xbb\x23\x81\x04\x08\xe8\x5b\x00\x00\x00\x89\xca\xb9\x19\x00\x00\x00\xb8\x55\x91\x04\x08\xbb\x88\x91\x04\x08\xd1\xca\x8a\x44\x08\xff\x8a\x5c\x0b\xff\x30\xd8\x30\xd0\x75\x1b\x49\x75\xe3\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x24\x91\x04\x08\xba\x26\x00\x00\x00\xcd\x80\xeb\x16\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x4a\x91\x04\x08\xba\x0b\x00\x00\x00\xcd\x80\xb8\x01\x00\x00\x00\x31\xdb\xcd\x80\x29\xc3\x31\xc9\x02\x08\xc1\xc1\x03\x40\x4b\x75\xf7\xc3";
    unsigned char hard_coded_string[]="\x1e\xcd\x2a\xd5\x34\x87\xfc\x78\x64\x35\x9d\xec\xde\x15\xac\x97\x99\xaf\x96\xda\x79\x26\x4f\x32\xe0";
    uint32_t ecx =0;
    uint32_t edx=0;
    for (int i = 0; i < sizeof(programme)-1; i++) {
        uint8_t cl = (ecx & 0xff);
        cl = cl + programme[i];
        ecx = (ecx & 0xffffff00) | cl;
        ecx = rol(ecx, 3);
    }
    edx = ecx;
    ecx = 0x19;

    char *sortie = malloc(0x20);
    char *registre_AL = malloc(0x20);
    sortie[0x19] = 0;
    do {
        edx = ror(edx, 1);
        uint8_t dl = edx & 0xff;
        uint8_t al = hard_coded_string[ecx - 1];
        sortie[ecx - 1] = al ^ dl;
        ecx--; 
          }while( ecx!=0);
printf("%s\n", sortie);
return 0;
}    
uint32_t ror(uint32_t x, int n) {
    uint32_t p = x >> n;
    uint32_t f = x << (32 - n);
    return p | p;
}

uint32_t rol(uint32_t x, int n) {
    uint32_t p = x << n;
    uint32_t f = x >> (32 - n);
    return p | f;
}